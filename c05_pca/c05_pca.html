<!DOCTYPE html>
<html lang="en"><head>
<script src="../libs/clipboard/clipboard.min.js"></script>
<script src="../libs/quarto-html/tabby.min.js"></script>
<script src="../libs/quarto-html/popper.min.js"></script>
<script src="../libs/quarto-html/tippy.umd.min.js"></script>
<link href="../libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="../libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.433">

  <title>Principal Components Analysis</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #24292e;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #24292e; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #d73a49; } /* Attribute */
    code span.bn { color: #005cc5; } /* BaseN */
    code span.bu { color: #d73a49; } /* BuiltIn */
    code span.cf { color: #d73a49; } /* ControlFlow */
    code span.ch { color: #032f62; } /* Char */
    code span.cn { color: #005cc5; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #d73a49; } /* DataType */
    code span.dv { color: #005cc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #d73a49; font-weight: bold; } /* Extension */
    code span.fl { color: #005cc5; } /* Float */
    code span.fu { color: #6f42c1; } /* Function */
    code span.im { color: #032f62; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #d73a49; } /* Keyword */
    code span.op { color: #24292e; } /* Operator */
    code span.ot { color: #6f42c1; } /* Other */
    code span.pp { color: #d73a49; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #005cc5; } /* SpecialChar */
    code span.ss { color: #032f62; } /* SpecialString */
    code span.st { color: #032f62; } /* String */
    code span.va { color: #e36209; } /* Variable */
    code span.vs { color: #032f62; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
  <link rel="stylesheet" href="../libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="../slides_quarto.css">
  <link href="../libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="../libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="../libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  
    <link rel="icon" href="../Intro2DS_logo.jpg" type="image/jpg"> 
    <link rel="shortcut icon" href="../Intro2DS_logo.jpg" type="image/jpg">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet" type="text/css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script></head>
  
  
  

<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="section" class="slide level2 logo-slide">
    <h2></h2>
    </section>
<section id="introduction-to-data-science" class="slide level2 title-slide center">
<h2>Introduction to Data Science</h2>
<h3 id="principal-components-analysis---class-4">Principal Components Analysis - Class 4</h3>
<h3 id="giora-simchoni">Giora Simchoni</h3>
<h4 id="gsimchonigmail.com-and-add-intro2ds-in-subject"><code>gsimchoni@gmail.com</code> and add <code>#intro2ds</code> in subject</h4>
<h3 id="stat.-and-or-department-tau">Stat. and OR Department, TAU</h3>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>בשיעור זה נלמד על ניתוח גורמים ראשיים, או principal components analysis. אפשר לראות ב-PCA כשיטה מתקדמת לחקר של דאטא ולכן אנחנו לומדים אותה ממש כעת. אפשר גם לראות בה הרבה מעבר. PCA היא הבסיס להרבה מאוד אלגוריתמים מתקדמים בחזית המחקר, אלגוריתמים שעוסקים בלמידת ייצוגים ממימד נמוך, לדאטא ממימד עצום, על מנת שנוכל ללמוד מהדאטא הזה משהו.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="the-pca-problem" class="slide level2 title-slide center">
<h2>The PCA Problem</h2>
</section>
<section class="slide level2">

<h3 id="some-intuition">Some intuition</h3>
<p>I have <span class="math inline">\(n\)</span> points with <span class="math inline">\(p = 2\)</span> dimensions. I wish to represent each point with a <strong>single</strong> number, without losing much information.</p>
<div class="cell" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">50</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>X1 <span class="op">=</span> np.random.normal(size<span class="op">=</span>n)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>X2 <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> X1 <span class="op">+</span> <span class="dv">3</span> <span class="op">+</span> np.random.normal(scale<span class="op">=</span><span class="fl">1.0</span>, size<span class="op">=</span>n)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.concatenate([X1[:, np.newaxis], X2[:, np.newaxis]], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> StandardScaler().fit_transform(X)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> np.concatenate([X, [[<span class="dv">3</span>, <span class="dv">3</span>]]], axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> pca.fit_transform(X)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>plt.scatter(X[:, <span class="dv">0</span>], X[:, <span class="dv">1</span>])</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'X2'</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'X1'</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Original Data'</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="op">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>))</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="op">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img data-src="c05_pca_files/figure-revealjs/cell-2-output-1.png" width="513" height="449"></p>
</div>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>נתחיל בדוגמא פשוטה ונתקדם משם. יש לי דאטא עם n תצפיות ושני משתנים. אני רוצה לייצג כל תצפית לא עם שני משתנים אלא עם אחד. מספר אחד שימצה אותה, וזאת עם לאבד כמה שפחות מידע. כלומר: אני רוצה להוריד את המימד מ2 ל1.</p>
<p>אם אני משרטט את הנתונים, ברור לי אינטואיטיבית מה הכיוון בהם, מה הקו או הוקטור ששומר את מקסימום המידע. זה הקו הזה.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<p>PCA will find the best direction to project the data on, while preserving the maximum “information”:</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span>(<span class="dv">13</span>, <span class="dv">5</span>))</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>plt.scatter(X[:, <span class="dv">0</span>], X[:, <span class="dv">1</span>])</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>plt.plot([<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>], [<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>], linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'r'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'X2'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'X1'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Best Direction'</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>plt.xlim((<span class="op">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>plt.ylim((<span class="op">-</span><span class="fl">3.5</span>, <span class="fl">3.5</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>plt.scatter(T, np.repeat(<span class="dv">0</span>, n <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">''</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'T1'</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>plt.tick_params(left <span class="op">=</span> <span class="va">False</span> , labelleft <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Projected Data'</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img data-src="c05_pca_files/figure-revealjs/cell-3-output-1.png" width="1034" height="449"></p>
</div>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>PCA יעשה בדיוק את זה. הוא ימצא את הכיוון, או הוקטור שלאורכו נשמר מירב המידע בנתונים, וכשנמצא את הוקטור הזה, נוכל להטיל את הנתונים עליו, כלומר כל תצפית תקבל את הערך שלה על הקו החשוב הזה. וככה נקבל את מה שרצינו: דאטא במימד שני משתנים, הפך לדאטא במימד אחד, עם כמה שפחות איבוד מידע.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="advanced-exploration-dimensionality-reduction">Advanced exploration: dimensionality reduction</h3>
<div>
<ul>
<li class="fragment">We have <span class="math inline">\(n\)</span> points in <span class="math inline">\(p\)</span> dimensions. In the Netflix Dataset: <span class="math inline">\(n=10^4, p=14\)</span> (considering only the fully observed movies)</li>
<li class="fragment">We want to reduce the data to <span class="math inline">\(q \ll p\)</span> dimensions (typically <span class="math inline">\(q=2\)</span> or <span class="math inline">\(q=3\)</span>), to:
<ul>
<li class="fragment">Identify <strong>important dimensions</strong> which summarize the data well</li>
<li class="fragment"><strong>Visualize</strong> the data (2-d or 3-d visualizations)</li>
<li class="fragment">Identify <strong>structure</strong> in the data, such as clusters</li>
</ul></li>
<li class="fragment">Naive way: select <span class="math inline">\(q\)</span> out of the original <span class="math inline">\(p\)</span> dimensions
<ul>
<li class="fragment">For <span class="math inline">\(q=2\)</span>, we have been looking at pairwise plots of movies</li>
</ul></li>
<li class="fragment">Less Naive way: Look for interesting “projections”: linear combinations of the variables which expose interesting information and patterns</li>
</ul>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>באופן כללי יש לנו נתונים עם n תצפיות ו-p משתנים. זה מתרגם למטריצה X עם n שורות ו-p עמודות. בדוגמא של נטפליקס n יהיה 10 אלפים ו-p יהיה 14 אם ניקח רק את הסרטים לגביהם יש לנו את כל הנתונים.</p>
<p>נרצה להוריד את המימד של הנתונים להיות q, כשq בדרך כלל קטן בהרבה מ-p, בד”כ 2 או 3. נראה שבדרך זה נוכל לזהות כיוונים חשובים בדאטא שמתמצתים אותו היטב, נוכל לעשות תרשים לדאטא בדו או תלת מימד (אי אפשר לצייר נקודות ב-14 מימד!) ואם אנחנו ברי מזל נוכל גם לראות מבנים בנתונים שלא היינו רואים אחרת, נראה את הנתונים שלנו ממש מתחלקים לאשכולות, לקלאסטרים.</p>
<p>איך מבצעים PCA? הדרך הנאיבית היא לבצע בחירה של q משתנים מתוך p.&nbsp;כל פעם שבחרנו שני סרטים בדאטא ועשינו תרשים פיזור של סרט אחד מול אחר זה בדיוק מה שעשינו! אבל איבדנו ככה המון מידע!</p>
<p>הדרך הנאיבית פחות היא לעשות מה שעשינו בשקף הקודם רק על הרבה משתנים: לחפש הטלות, לחפש צירופים ליניאריים של המשתנים שיהוו כיוונים מעניינים בדאטא. בואו נפרמל את הבעיה הזאת.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="mathematical-setup">Mathematical setup</h3>
<div>
<ul>
<li class="fragment"><p>We have <span class="math inline">\(n\)</span> vectors in <span class="math inline">\({\mathbb R}^p\)</span>: <span class="math inline">\(\mathbf{x}_1, \dots, \mathbf{x}_n\)</span></p></li>
<li class="fragment"><p>We can desribe them thorugh a matrix <span class="math inline">\(X_{n \times p}\)</span> (each row is an observation)</p></li>
<li class="fragment"><p>Assume for simplicity that the columns are centered: <span class="math inline">\(\sum_i x_{ij} = 0,\;\forall j\)</span>, so our data is a cloud around <span class="math inline">\(0\)</span> in <span class="math inline">\({\mathbb R}^p\)</span></p></li>
<li class="fragment"><p>Total dispersion (squared distance of points from their center): <span class="math inline">\(\sum_{ij} x_{ij}^2 = ||\mathbf{x}_1||_2^2+ \dots + ||\mathbf{x}_n||_2^2 = \text{tr}(X'X)\)</span></p></li>
<li class="fragment"><p>Possible goal: find <span class="math inline">\(q \ll p\)</span> good directions, such that <strong>much of the dispersion</strong> will be captured by these directions.</p></li>
<li class="fragment"><p>A direction in <span class="math inline">\({\mathbb R}^p\)</span> is a vector <span class="math inline">\(\mathbf{v}\in {\mathbb R}^p\)</span> with <span class="math inline">\(||\mathbf{v}||_2^2=1\)</span></p></li>
</ul>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>כל תצפית היא וקטור באורך p.&nbsp;יש לנו n תצפיות או וקטורים כאלה, x1 עד xn.</p>
<p>אפשר לסדר את הוקטורים האלה אחד מתחת לשני במטריצה n על p, כאשר כל שורה היא וקטור.</p>
<p>נניח לרגע שכל עמודה ממורכזת, כלומר הסכום שלה או הממוצע שלה הוא אפס. אם כל משתנה ממורכז סביב האפס, ניתן לראות בנתונים שלנו מאין “ענן” סביב הראשית במרחב p מימדי. שוב כל פעם שהמילים מרחב p מימדי מרתיעות אתכם, חשבו על p = 2 או p = 3, מימדים שניתן לדמיין.</p>
<p>דרך אחת לתאר כמה מידע יש במטריצה הזאת, מידע שנרצה לשמר, הוא הפיזור הריבועי של התצפיות מהמרכז שלהן. אם הנחנו שהמרכז שלהן באפס אז הכמות הזאת תהיה פשוט הוקטורים בריבוע, או הטרייס של X טרנספוז X, מטריצת הקווריאנס של המדגם הזה.</p>
<p>אז יש לנו כמות לשמר, ואנחנו רוצים למצור q כיוונים שאם נטיל את המטריצה שלנו עליהם, נשמר כמה שיותר מהכמות הזאת, מהפיזור הזה, מהשונות של הדאטא.</p>
<p>וכשאנחנו אומרים כיוון, אנחנו מתכוונים לוקטור פי מימדי עם נורמה 1, כלומר וקטור מנורמל או וקטור יחידה. נסמן אותו ב-v.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="the-pca-problem-1">The PCA Problem</h3>
<div>
<ul>
<li class="fragment"><p>Goal: Find the <span class="math inline">\(q\)</span> direction(s) with the most dispersion</p></li>
<li class="fragment"><p>Projection is direction <span class="math inline">\(\mathbf{v}\)</span>: <span class="math inline">\(X\mathbf{v} \in \mathbb R^n.\)</span> Examples:</p>
<ul>
<li class="fragment"><span class="math inline">\(\mathbf{v} = (1,0,\dots,0)'\)</span>: pick first coordinate from each observation</li>
<li class="fragment"><span class="math inline">\(\mathbf{v} = (1/\sqrt{p},1/\sqrt{p},\dots,1/\sqrt{p})'\)</span>: project on diagonal (average all coordinates)</li>
</ul></li>
<li class="fragment"><p>Dispersion in direction <span class="math inline">\(\mathbf{v}\)</span>: <span class="math inline">\(||X\mathbf{v}||^2 = \mathbf{v}'(X'X)\mathbf{v}.\)</span></p></li>
<li class="fragment"><p>Finding the best direction which maximizes dispersion: <span class="math inline">\(\mathbf{v}_1 = \arg\max_{\mathbf{v}:\|\mathbf{v}\|^2 =1} \|X\mathbf{v}\|^2\)</span></p></li>
<li class="fragment"><p><span class="math inline">\(\mathbf{v}_1\)</span> is the first Principal Component direction: the best direction to project on!</p></li>
</ul>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>אז אנחנו רוצים למצוא את וקטור ההטלה ששומר על הכי הרבה פיזור. בואו ניתן דוגמאות:</p>
<p>אם v יהיה למשל וקטור הבסיס הטריוויאלי בR^p, שיש בו 1 בקואורדינטה הראשונה ואפס בכל השאר - כשנטיל את המטריצה עליו דבר זה יהיה שקול לבחירת המשתנה הראשון. כלומר המספר שייצג כל תצפית יהיה הערך שלה בעמודה הראשונה.</p>
<p>אם ניתן משקולת שווה לכל קוארדינטה, ומשקולת כזאת חייבת להיות 1 חלקי שורש p כדי שהוקטור יהיה מנורמל - הטלה של המטריצה שלנו עליו תהיה שקולה ללקחת את הממוצע של כל המשתנים עבור כל תצפית.</p>
<p>ובואו נגדיר מהו הפיזור של ההטלה Xv, מדובר בנורמה של הוקטור הזה, שאנו רואים בביטוי v’X’Xv.</p>
<p>לסיכום הנה הבעיה של PCA: נרצה לבחור את הכיוון v שימקסם את הפיזור של ההטלה v’X’Xv.</p>
<p>כשנמצא אותו, נקרא לכיוון הזה הprinicipal component direction הראשון. זה הכיוון הטוב ביותר להטיל עליו!</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="how-do-we-find-the-next-principal-component">How do we find the next principal component?</h3>
<div>
<ul>
<li class="fragment"><p>Now we want a <strong>different</strong> direction <span class="math inline">\(\mathbf{v}_2\)</span> which maximizes dispersion after accounting for <span class="math inline">\(\mathbf{v}_1\)</span>.</p></li>
<li class="fragment"><p>Require orthogonality: <span class="math inline">\(\mathbf{v}_2 = \arg\max_{||\mathbf{v}||^2 =1, \mathbf{v}'\mathbf{v}_1 = 0}||X\mathbf{v}||^2\)</span></p></li>
<li class="fragment"><p>This is the second principal direction</p></li>
<li class="fragment"><p>Can keep going looking for new directions</p></li>
<li class="fragment"><p>Assuming <span class="math inline">\(p &lt; n\)</span>, up to <span class="math inline">\(p\)</span> principal directions can be found this way, stack them into a <span class="math inline">\(p \times p\)</span> “loadings” matrix <span class="math inline">\(W\)</span></p></li>
<li class="fragment"><p>Data with reduced dimensionality: <span class="math inline">\(T_{n \times q} = X_{n \times p}W_{p \times q}\)</span> taking only the first <span class="math inline">\(q\)</span> principal directions</p></li>
</ul>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>אבל זה רק כיוון ראשון. אמרנו שאנחנו רוצים q כיוונים. איך נמצא את הכיוונים הבאים?</p>
<p>הכיוון הבא v2 יהיה הכיוון שממקסם את פיזור ההטלה, אחרי שהתחשבנו כבר בכיוון v1.</p>
<p>אפשר לראות שהדבר שקול לדרישת אורתוגנוליות. הוקטור שאנחנו מחפשים v2 ממקסם את פיזור ההטלה, הנורמה שלה, כך שהוא מנורמל וגם הוא אורתוגנלי לוקטור הראשון.</p>
<p>זה יהיה הכיוון השני, ואפשר להמשיך לכיוון שלישי וכך עד שמשיגים q כיוונים מנורמלים אורתוגונליים זה לזה.</p>
<p>כשנשיג q וקטורים כאלה, כל אחד באורך p, נוכל להציב אותם זה לצד זה ולקבל מטריצה שנסמן כW. קוראים למטריצה כזאת הרבה פעמים loadings, כי מה שיש בכל וקטור ווקטור שמצאנו הוא בעצם המשקולות לכל משתנה ומשתנה מהדאטא המקורי. אם בדאטא המקורי לדוגמא יש 3 משתנים, והוקטור v שאנחנו מצאנו הוא (1/sqrt(3), sqrt(2)/sqrt(3), 0), שהוא בערך (0.57, 0.81, 0), זה אומר שהמשתנה הראשון קיבל משקולת 0.57, המשתנה השני 0.81, והשלישי משקולת 0, הוא לא חשוב לכיוון הזה שמצאנו.</p>
<p>ההטלה עצמה גם היא תהיה חשובה לנו: אם נכפול את הדאטא n על p שלנו במטריצת ההטלה W שבה יש את q הכיוונים הראשונים, נקבל דאטא ממימד נמוך יותר, מימד q. נקרא לו T.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="pca-on-netflix-dataset" class="slide level2 title-slide center">
<h2>PCA on Netflix Dataset</h2>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>נעשה רגע הפסקה בכל האלגברה הזאת לראות את השורה התחתונה כדי שתהיה לנו מוטיבציה לחזור שוב לחלק המתמטי ולראות איך מוצאים את פתרון ה-PCA.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="pca-on-the-netflix-data">PCA on the Netflix data</h3>
<div>
<ul>
<li class="fragment"><p>Our Netflix dataset contains the 1-5 rankings made by 10,000 users to 99 movies.</p></li>
<li class="fragment"><p>Let <span class="math inline">\(X\)</span> be the data matrix for the first 14 movies to which all users gave ranking.</p></li>
<li class="fragment"><p>So: <span class="math inline">\(n = 10000\)</span> and <span class="math inline">\(p = 14\)</span>. This isn’t that “Big”, however even with 14 variables it is almost impossible to see any latent structure hidden in the data.</p></li>
<li class="fragment"><p>Let’s perform PCA!</p></li>
</ul>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>ניזכר שוב בדאטא של התחרות של נטפליקס, שמכיל דירוגים מ-1 עד 5 על 99 סרטים.</p>
<p>X יהיה המטריצה עם עשרת אלפים שורות על 14 הסרטים הראשונים אותם דירגו כל עשרת אלפים המשתמשים.</p>
<p>n שווה 10000, p שווה 14, זה לא כזה גדול אבל כאמור איך תעשו ויזואליזציה לדאטא 14 מימדי?!</p>
<p>נבצע PCA עם פייתון.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="remember-the-data">Remember the Data</h3>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>ratings <span class="op">=</span> pd.read_csv(<span class="st">'../datasets/netflix/train_ratings_all.csv'</span>, header <span class="op">=</span> <span class="va">None</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>miss_cong <span class="op">=</span> pd.read_csv(<span class="st">'../datasets/netflix/train_y_rating.csv'</span>, header <span class="op">=</span> <span class="va">None</span>, names <span class="op">=</span> [<span class="st">'score'</span>])</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>movies <span class="op">=</span> pd.read_csv(<span class="st">'../datasets/netflix/movie_titles.csv'</span>, header <span class="op">=</span> <span class="va">None</span>, names <span class="op">=</span> [<span class="st">'year'</span>, <span class="st">'title'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="4">
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
<div class="fragment">
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> ratings.values[:,:<span class="dv">14</span>]</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(10000, 14)</code></pre>
</div>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="cell-output cell-output-stdout">
<pre><code></code></pre>
</div>
</div>
<div class="fragment">
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X[:<span class="dv">5</span>, :<span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[2 4 4 4 5]
 [4 5 3 3 4]
 [5 5 5 5 5]
 [3 3 3 4 4]
 [4 4 4 5 4]]</code></pre>
</div>
</div>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>אנחנו קוראים את הנתונים כפי שעשינו ביחידה הקודמת, ומוודאים שהמימדים הם כפי שאנחנו מצפים, 10000 על 14.</p>
<p>שוב נציץ לתוך הדאטא: יש כאן פשוט מספרים מ-1 עד 5.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="centering-the-data">Centering the Data</h3>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># currently..</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>X.mean(axis<span class="op">=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>array([4.1463, 4.1073, 3.7045, 4.3482, 4.0748, 4.5143, 4.4563, 3.7287,
       3.7546, 3.6749, 3.7316, 4.0183, 4.0168, 3.706 ])</code></pre>
</div>
</div>
<div class="fragment">
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># centering X: subtracting the mean from each column</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>X_centered <span class="op">=</span> X <span class="op">-</span> X.mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(X_centered.mean(axis<span class="op">=</span><span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[-9.66338121e-17 -3.95061761e-16  1.38555833e-16 -2.87059265e-16
  2.44426701e-16 -4.23483471e-16  2.94164693e-16  9.66338121e-17
  6.25277607e-17 -5.68434189e-17  1.43174361e-16  1.70530257e-17
  7.38964445e-17  7.36299910e-17]</code></pre>
</div>
</div>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>ניזכר שניתוח PCA אנחנו עושים על מטריצת אחרי שהיא עברה מרכוז או סנטרינג. כרגע היא כמובן לא ממורכזת, הממוצע של כל עמודה שונה מאפס.</p>
<p>כדי למרכז את הנתונים נחסר מכל עמודה את הממוצע שלה. כעת באוביקט X centered, יש את הנתונים שלנו אחרי מרכוז, אפשר לראות שהממוצע של כל עמודה הוא אפס מבחינה נומרית.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="performing-pca">Performing PCA</h3>
<div class="fragment">
<p>Performing PCA in 3 lines:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="|1|3-4|6-7|"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co"># instantiating PCA object</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>pca <span class="op">=</span> PCA()</span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co"># performing PCA</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>pca.fit(X_centered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="fragment">
<p>What did we get?</p>
</div>
<div class="fragment">
<p>The <span class="math inline">\(W\)</span> matrix, a.k.a the “loadings”, each column is a principal direction:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>W <span class="op">=</span> pca.components_.T</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(W.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(14, 14)</code></pre>
</div>
</div>
<p>Let’s see the W matrix first 2 principal directions alongside the movies: do you see anything interesting?</p>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>איך עושים PCA על הנתונים שלנו? זאת בעצם הפעם הראשונה שאנחנו נתקלים בספריית sklearn, זאת ספריית אופן סורס או קוד פתוח, למימוש מודלים סטטיסטיים ומודלים של למידת מכונה שעוד נלמד עליהם.</p>
<p>כאן אני מייבא את הקלאס המתאים PCA ממודול של sklearn שנקרא decomposition.</p>
<p>אני מאתחל את הקלאס באמצעות אובייקט שאני קורא לו pca. בשלב הזה יכולתי למשל לפרט מהו q הרצוי באמצעות פרמטר הn_components, לדוגמא n_components=2.</p>
<p>פעולת הPCA עצמה קוראת רק כשאני קורא למתודה פיט של האוביקט, כשאני מכניס לתוכה את הנתונים שלי, X_centered. המתודה הזו מחזירה איזשהו טיפוס שלא מעניין אותנו כרגע ולכן אני קולט אותו עם קו תחתון.</p>
<p>וזהו, עשינו PCA. אבל מה קיבלנו?</p>
<p>קיבלנו את המטריצה W, בשדה components קו תחתון. נשים לב שמאחר שלא פירטנו מהו q כמה כיוונים אנחנו רוצים, קיבלנו את מקסימום הכיוונים האפשרי שזהוא p, לכן המטריצה W שלנו היא בגודל p על p.&nbsp;נשים לב גם שsklearn מחזיר את המטריצה כפי שאנחנו סימנו אותו עם טרנספוז, בגלל זה צריך לעשות על הארגומנט קומפוננטס טרנספוז אם רוצים לקבל את W כפי שאנחנו סיכמנו.</p>
<p>אבל זה עדיין לא אומר מה קיבלנו. בדרך כלל מעניינים אותנו שניים-שלושה הכיוונים הראשונים, בואו נראה את המשקולות שלהם לכל סרט וסרט:</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<div class="cell" data-execution_count="14">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>means <span class="op">=</span> pd.DataFrame(X.mean(axis <span class="op">=</span> <span class="dv">0</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>means.columns <span class="op">=</span> [<span class="st">'mean_rating'</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>loadings2 <span class="op">=</span> pd.DataFrame(W[:, :<span class="dv">2</span>], columns <span class="op">=</span> [<span class="st">'PC1'</span>, <span class="st">'PC2'</span>])</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>first_2_PCs <span class="op">=</span> pd.concat([movies[:<span class="dv">14</span>][<span class="st">'title'</span>], means, loadings2], axis <span class="op">=</span> <span class="dv">1</span>).set_index(<span class="st">'title'</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>first_2_PCs.head(<span class="dv">10</span>).style.applymap(color_negative_red).<span class="bu">format</span>(<span class="st">"</span><span class="sc">{:.2f}</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<style type="text/css">
#T_ec6ae_row0_col0, #T_ec6ae_row1_col0, #T_ec6ae_row2_col0, #T_ec6ae_row3_col0, #T_ec6ae_row4_col0, #T_ec6ae_row4_col2, #T_ec6ae_row5_col0, #T_ec6ae_row5_col2, #T_ec6ae_row6_col0, #T_ec6ae_row6_col2, #T_ec6ae_row7_col0, #T_ec6ae_row8_col0, #T_ec6ae_row9_col0, #T_ec6ae_row9_col2 {
  color: black;
}
#T_ec6ae_row0_col1, #T_ec6ae_row0_col2, #T_ec6ae_row1_col1, #T_ec6ae_row1_col2, #T_ec6ae_row2_col1, #T_ec6ae_row2_col2, #T_ec6ae_row3_col1, #T_ec6ae_row3_col2, #T_ec6ae_row4_col1, #T_ec6ae_row5_col1, #T_ec6ae_row6_col1, #T_ec6ae_row7_col1, #T_ec6ae_row7_col2, #T_ec6ae_row8_col1, #T_ec6ae_row8_col2, #T_ec6ae_row9_col1 {
  color: red;
}
</style>

<table id="T_ec6ae" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th class="blank level0" data-quarto-table-cell-role="th">&nbsp;</th>
<th id="T_ec6ae_level0_col0" class="col_heading level0 col0" data-quarto-table-cell-role="th">mean_rating</th>
<th id="T_ec6ae_level0_col1" class="col_heading level0 col1" data-quarto-table-cell-role="th">PC1</th>
<th id="T_ec6ae_level0_col2" class="col_heading level0 col2" data-quarto-table-cell-role="th">PC2</th>
</tr>
<tr class="odd">
<th class="index_name level0" data-quarto-table-cell-role="th">title</th>
<th class="blank col0" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col1" data-quarto-table-cell-role="th">&nbsp;</th>
<th class="blank col2" data-quarto-table-cell-role="th">&nbsp;</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td id="T_ec6ae_level0_row0" class="row_heading level0 row0" data-quarto-table-cell-role="th">Independence Day</td>
<td id="T_ec6ae_row0_col0" class="data row0 col0">4.15</td>
<td id="T_ec6ae_row0_col1" class="data row0 col1">-0.25</td>
<td id="T_ec6ae_row0_col2" class="data row0 col2">-0.26</td>
</tr>
<tr class="even">
<td id="T_ec6ae_level0_row1" class="row_heading level0 row1" data-quarto-table-cell-role="th">The Patriot</td>
<td id="T_ec6ae_row1_col0" class="data row1 col0">4.11</td>
<td id="T_ec6ae_row1_col1" class="data row1 col1">-0.26</td>
<td id="T_ec6ae_row1_col2" class="data row1 col2">-0.06</td>
</tr>
<tr class="odd">
<td id="T_ec6ae_level0_row2" class="row_heading level0 row2" data-quarto-table-cell-role="th">The Day After Tomorrow</td>
<td id="T_ec6ae_row2_col0" class="data row2 col0">3.70</td>
<td id="T_ec6ae_row2_col1" class="data row2 col1">-0.32</td>
<td id="T_ec6ae_row2_col2" class="data row2 col2">-0.15</td>
</tr>
<tr class="even">
<td id="T_ec6ae_level0_row3" class="row_heading level0 row3" data-quarto-table-cell-role="th">Pirates of the Caribbean: The Curse of the Black Pearl</td>
<td id="T_ec6ae_row3_col0" class="data row3 col0">4.35</td>
<td id="T_ec6ae_row3_col1" class="data row3 col1">-0.15</td>
<td id="T_ec6ae_row3_col2" class="data row3 col2">-0.03</td>
</tr>
<tr class="odd">
<td id="T_ec6ae_level0_row4" class="row_heading level0 row4" data-quarto-table-cell-role="th">Pretty Woman</td>
<td id="T_ec6ae_row4_col0" class="data row4 col0">4.07</td>
<td id="T_ec6ae_row4_col1" class="data row4 col1">-0.23</td>
<td id="T_ec6ae_row4_col2" class="data row4 col2">0.45</td>
</tr>
<tr class="even">
<td id="T_ec6ae_level0_row5" class="row_heading level0 row5" data-quarto-table-cell-role="th">Forrest Gump</td>
<td id="T_ec6ae_row5_col0" class="data row5 col0">4.51</td>
<td id="T_ec6ae_row5_col1" class="data row5 col1">-0.11</td>
<td id="T_ec6ae_row5_col2" class="data row5 col2">0.01</td>
</tr>
<tr class="odd">
<td id="T_ec6ae_level0_row6" class="row_heading level0 row6" data-quarto-table-cell-role="th">The Green Mile</td>
<td id="T_ec6ae_row6_col0" class="data row6 col0">4.46</td>
<td id="T_ec6ae_row6_col1" class="data row6 col1">-0.16</td>
<td id="T_ec6ae_row6_col2" class="data row6 col2">0.00</td>
</tr>
<tr class="even">
<td id="T_ec6ae_level0_row7" class="row_heading level0 row7" data-quarto-table-cell-role="th">Con Air</td>
<td id="T_ec6ae_row7_col0" class="data row7 col0">3.73</td>
<td id="T_ec6ae_row7_col1" class="data row7 col1">-0.30</td>
<td id="T_ec6ae_row7_col2" class="data row7 col2">-0.32</td>
</tr>
<tr class="odd">
<td id="T_ec6ae_level0_row8" class="row_heading level0 row8" data-quarto-table-cell-role="th">Twister</td>
<td id="T_ec6ae_row8_col0" class="data row8 col0">3.75</td>
<td id="T_ec6ae_row8_col1" class="data row8 col1">-0.30</td>
<td id="T_ec6ae_row8_col2" class="data row8 col2">-0.14</td>
</tr>
<tr class="even">
<td id="T_ec6ae_level0_row9" class="row_heading level0 row9" data-quarto-table-cell-role="th">Sweet Home Alabama</td>
<td id="T_ec6ae_row9_col0" class="data row9 col0">3.67</td>
<td id="T_ec6ae_row9_col1" class="data row9 col1">-0.30</td>
<td id="T_ec6ae_row9_col2" class="data row9 col2">0.59</td>
</tr>
</tbody>
</table>
</div>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>בטבלה הזאת, מוצגים עשרת הסרטים הראשונים: השם שלהם, ממוצע הדירוג שלהם, והמשקולות שלהם במה שאנחנו קראנו v1 ו-v2, הם כיווני ה-PC הראשונים כלומר שתי העמודות הראשונות ב-W.</p>
<p>למי שמעוניין הקוד מצורף כאן במצגת.</p>
<p>הסתכלו רגע על הטבלה ונסו למצוא פרשנות כלשהי למשקולות של ה-PC הראשון, ולמשקולות של ה-PC השני.</p>
<p>קצת קשה לראות את זה. ובכל זאת שימו לב שהמשקולות ב-PC הראשון הן כולן לאותו כיוון. והגודל שלהן קשור מאוד בפופולריות הכללית של הסרט. ככל שהדירוג הממוצע של הסרט גדול יותר, כך קטנות המשקלות בערך מוחלט. כלומר נראה שהכיוון בנתונים ששומר על הכי הרבה פיזור, אם היינו צריכים לתת מספר אחד לכל תצפית שהיא במקרה שלנו צופה שראתה 14 סרטים, היינו מסתכלים כמה הצופה הזאת מסכימה עם הממוצע!</p>
<p>לגבי הכיוון השני, צריך קצת להכיר את הסרטים כדי לראות את זה. אבל בואו נראה את זה עם תרשים.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="pc-directions-in-a-plot">PC directions in a plot</h3>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.scatterplot(x<span class="op">=</span><span class="st">'PC1'</span>, y<span class="op">=</span><span class="st">'PC2'</span>, size<span class="op">=</span><span class="st">'mean_rating'</span>, data<span class="op">=</span>first_2_PCs)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, point <span class="kw">in</span> first_2_PCs.iterrows():</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    ax.text(point[<span class="st">'PC1'</span>], point[<span class="st">'PC2'</span>], <span class="bu">str</span>(i))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">'r'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img data-src="c05_pca_files/figure-revealjs/cell-17-output-1.png" width="808" height="429"></p>
</div>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>בתרשים הפיזור שלפנינו כל סרט הוא נקודה, שהגודל שלה נקבע על-ידי כמה הסרט פופולרי. רכיב הX של הנקודה הוא המשקל שלה בPC הראשון, ורכיב הY שלה הוא המשקל שלה בPC השני.</p>
<p>את מה שראינו בטבלה אפשר לראות גם כאן, ככל שהסרט פופולרי יותר כך הנקודה קטנה בערך מוחלט.</p>
<p>אבל על “מדבר” הPC השני? אם אתם מכירים את הסרטים ברשימה זה די ברור: הPC השני מבדיל בין סרטים רומנטיים גמו אשה יפה, סוויט הום אלבמה, לבין סרטי אקשן, כמו קון איר וארמגדון.</p>
<p>כלומר אחרי שהתחשבנו בכיוון הראשון שמבטא כמה צופה מדרגת סרטים פשוט על-פי הפופולריות שלהם, הכיוון השני מבדיל כנראה בין צופים שאוהבים סרטים רומנטיים לבין סרטים שמעדיפים סרטי אקשן.</p>
<p>חשוב להדגיש כבר עכשיו - זו פרשנות! כאן היא ממש קופצת מול העיניים, הרבה פעמים זה לא יהיה כל כך פשוט.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="projected-data">Projected Data</h3>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> X_centered <span class="op">@</span> W <span class="co"># make sure this is the same as pca.transform(X_centered)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(T.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(10000, 14)</code></pre>
</div>
</div>
<p>More typically we would want to <strong>reduce</strong> dimensionality:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> X_centered <span class="op">@</span> W[:, :<span class="dv">2</span>]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(T.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(10000, 2)</code></pre>
</div>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>אמרנו שגם הדאטא של ההטלה מעניין אותנו. אחרי שנכפול את X בW נקבל את T שהיא מטריצה מסדר גודל עשרת אלפים על 14. בעצם קיבלנו שוב מטריצת נתונים מסדר גודל 10000 על 14 אבל כזאת שהעמודות שלה אורתוגנוליות זו לזה, והיא מחלקת את הפיזור או השונות המקוריים בצורה שונה לגמרי. העמודה הראשונה תהיה עם הפיזור הגדול ביותר, לאחר מכן השניה וכולי.</p>
<p>בדרך כלל נתעניין בהורדת מימד, כלומר בהכפלה של X רק בעמודות הראשונות של W, כדי לקבל מטריצה T עם 2 עמודות בלבד.</p>
<p>עכשיו אפשר סוף סוף לעשות ויזואליזציה לנתונים שלנו, עם תרשים פיזור פשוט:</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<div class="cell" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sns.jointplot(x<span class="op">=</span>T[:,<span class="dv">0</span>], y<span class="op">=</span>T[:,<span class="dv">1</span>], height<span class="op">=</span><span class="fl">3.5</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>ax.set_axis_labels(<span class="st">'PC1: Popular Vote'</span>, <span class="st">'PC2: Romance vs. Action'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img data-src="c05_pca_files/figure-revealjs/cell-20-output-1.png" width="343" height="345"></p>
</div>
</div>
<div>
<ul>
<li class="fragment">The first PC will indicate to what extent the user conforms with the general popular vote of movies</li>
<li class="fragment">The second PC will indicate if the user is a romance-comedy-drama or action person</li>
<li class="fragment">Are there interesting clusters or people worth pointing at? Would have been nice to see users’ gender here!</li>
</ul>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>על ציר האיקס הציון של כל צופה בPC הראשון, או עד כמה הצופה דומה בדירוגים שלו לדיעה הפופולרית.</p>
<p>על ציר הוואי הציון של כל צופה בPC השני, עד כמה הוא מעדיף סרטים רומנטיים על פני סרטי אקשן.</p>
<p>בשלב הזה פעמים רבות מתגלים אשכולות מעניינים בדאטא, או קלאסטרים. כאן קשה לראות אשכולות מעניינים אבל היה מעניין לצבוע את המגדר של הצופים כאן, ולראות האם אכן נכונה הסטיגמה שנשים אוהבות יותר סרטים רומנטיים וגברים אוהבים יותר סרטי אקשן. אם הסטיגמה נכונה נראה יותר נשים במעלה הגרף, ויותר גברים בתחתית הגרף.</p>
<p>עדיין חשוב להבין מה מייצגות תצפיות הקצה לראות שהבנו: כאן (תצפית הכי עליונה) יש צופה שנותן ציונים גבוהים לסרטים רומנטיים וציונים נמוכים יחסית לסרטי אקשן. כאן (נקודה הכי ימנית) יש צופה שפשוט מצביע הפוך לדעת הרוב, מאחר שהציונים הממוצעים די גבוהים, הצופה הזה כנראה שונא את כל הסרטים. ואילו כאן (נקודה הכי שמאלית) נראה צופה שנותנת ציונים בתיאום עם הדעה הפופולרית, כנראה ציונים גבוהים באופן כללי לכל הסרטים.PC הראשון.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="and-now-miss-congeniality">And now: Miss Congeniality!</h3>
<p>What do you expect the scores to be for users that are high on 1st PC (hate all films)?</p>
<div class="fragment">
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>PC1_top_100 <span class="op">=</span> T[:, <span class="dv">0</span>].argsort()[<span class="op">-</span><span class="dv">100</span>:]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Top PC1:'</span>, miss_cong.iloc[PC1_top_100, :].groupby(<span class="st">'score'</span>).size())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Top PC1: score
1    30
2    32
3    30
4     8
dtype: int64</code></pre>
</div>
</div>
</div>
<p>What do you expect the scores to be for users that are low on 1st PC (love all films)</p>
<div class="fragment">
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>PC1_bottom_100 <span class="op">=</span> T[:, <span class="dv">0</span>].argsort()[:<span class="dv">100</span>]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Bottom PC1:'</span>, miss_cong.iloc[PC1_bottom_100, :].groupby(<span class="st">'score'</span>).size())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bottom PC1: score
3     5
4    16
5    79
dtype: int64</code></pre>
</div>
</div>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>מה לגבי הסרט איזו מין שוטרת? אילו ציונים נצפה לראות מצופים שגבוהים בPC הראשון, כלומר שונאים את כל הסרטים?</p>
<p>אם ניקח את מאה הצופים עם ציון הכי גבוה בPC הראשון נראה שהם אכן נתנו ציון נמוך מאוד גם לאיזו מין שוטרת.</p>
<p>ומה לגבי 100 הצופים עם הציון הכי נמוך בPC הראשון, כלומר צופים שאוהבים הכל – נראה שאכן הם אהבו גם את איזו מין שוטרת.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<p>What do you expect the scores to be for users that are high on 2nd PC (like romantic films)?</p>
<div class="fragment">
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>PC2_top_100 <span class="op">=</span> T[:, <span class="dv">1</span>].argsort()[<span class="op">-</span><span class="dv">100</span>:]</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Top PC2:'</span>, miss_cong.iloc[PC2_top_100, :].groupby(<span class="st">'score'</span>).size())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Top PC2: score
2    12
3    26
4    28
5    34
dtype: int64</code></pre>
</div>
</div>
</div>
<p>What do you expect the scores to be for users that are low on 2nd PC (like action films)</p>
<div class="fragment">
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>PC2_bottom_100 <span class="op">=</span> T[:, <span class="dv">1</span>].argsort()[:<span class="dv">100</span>]</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Bottom PC2:'</span>, miss_cong.iloc[PC2_bottom_100, :].groupby(<span class="st">'score'</span>).size())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bottom PC2: score
1    17
2    27
3    35
4    12
5     9
dtype: int64</code></pre>
</div>
</div>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>בשביל לצפות מה יהיו הציונים של צופים גבוהים או נמוכים בPC הראשון, צריך קודם להחליט האם איזו מין שוטרת הוא סרט רומנטי או סרט אקשן. מי שראה את הסרט ידע להגיד שזה לא חד משמעי, אבל בגדול זה סרט שהצד הרך שלו, הקומי-רומנטי, דומיננטי יותר. ולכן זה לא מפתיע שצופים שגבוהים בPC השני נותנים ציונים גבוהים יחסית לאיזו מין שוטרת, וצופים שנמוכים בPC השני נותנים ציונים נמוכים יחסית לאיזו מין שוטרת.</p>
<p>לפני שנחזור לחלק המתמטי, אני מקווה שאתם מתרשמים איזה כלי מדהים זה PCA. מאוחר יותר נרצה אולי לחזות כיצד ידרג משתמש שלא ראינו בדאטא, את הסרט איזו מין שוטרת, על סמך שאר הדירוגים שלו. הכיוונים האלה שגילינו יכולים לעזור לנו מאוד, אפשר לומר שמצאנו משתנים חדשים בדאטא, משתנים שאנחנו יודעים שמשמרים הרבה מהשונות, ונוכל לבקש על הצופה הזה שאלה פשוטה שאולי לא היינו חושבים עליה בכלל - האם יש לך העדפה לסרטים רומנטיים על פני סרטי אקשן?</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="scree-plot-of-explained-variance">Scree Plot: % of explained variance</h3>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>plt.plot(np.arange(pca.n_components_) <span class="op">+</span> <span class="dv">1</span>, pca.explained_variance_ratio_, <span class="st">'o-'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Scree Plot'</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Principal Component'</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'% Variance Explained'</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img data-src="c05_pca_files/figure-revealjs/cell-25-output-1.png" width="523" height="449"></p>
</div>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">
<p>עוד תרשים שעשוי לעניין אתכם נקרא סקרי-פלוט, שמשתמש בשדה explained_variance_ratio_ של אוביקט ה-PCA. הסקריפלוט מצייר את אחוז השונות המוסברת של כל PC. בדרך כלל נראה דפוס יורד בחדות, הPC הראשונים מסבירים אחוז ניכר מהשונות, ואלה שבאים אחריהם מסבירים מעט מאוד.</p>
<p>לפעמים נעזרים בתרשים כזה לדעת מה המימד הראוי לנתונים. ובכל מקרה אחוזי השונות המוסברת מסתכמים למאה אחוז.</p>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="pca-via-svd" class="slide level2 title-slide center">
<h2>PCA via SVD</h2>
</section>
<section class="slide level2">

<h3 id="calculating-principal-components-the-svd">Calculating Principal Components: the SVD</h3>
<div>
<ul>
<li class="fragment"><p>We have the matrix <span class="math inline">\(X_{n \times p}\)</span> and want to find: <span class="math display">\[\mathbf{v}_1 = \arg\max_{\mathbf{v}:\|\mathbf{v}\|^2 =1} \|X\mathbf{v}\|^2\]</span> <span class="math display">\[\mathbf{v}_2 = \arg\max_{\mathbf{v}:\|\mathbf{v}\|^2 =1, \mathbf{v}^T\mathbf{v}_1 = 0}\|X\mathbf{v}\|^2\]</span> Etc.</p></li>
<li class="fragment"><p>The key: the Singular value decomposition (SVD) <span class="math inline">\(X = U D V'\)</span>, where:</p>
<ul>
<li class="fragment"><span class="math inline">\(U_{n\times p}\)</span> is a matrix with orthonormal columns: <span class="math inline">\(U'U = I_{p \times p}\)</span></li>
<li class="fragment"><span class="math inline">\(D_{p\times p}\)</span> is a diagonal matrix with non-negative diagonal elements (called the Singular Values)</li>
<li class="fragment"><span class="math inline">\(V_{p\times p}\)</span> is an orthogonal matrix: its columns are an orthonormal basis of <span class="math inline">\(\mathbb R^p\)</span>, <span class="math inline">\(V'V = V V' = I\)</span>.</li>
</ul></li>
</ul>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">

</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="more-on-the-svd">More on the SVD</h3>
<ul>
<li>The key: the Singular value decomposition (SVD) <span class="math inline">\(X = U D V'\)</span>, where:
<ul>
<li><span class="math inline">\(U_{n\times p}\)</span> is a matrix with orthonormal columns: <span class="math inline">\(U'U = I_{p \times p}\)</span></li>
<li><span class="math inline">\(D_{p\times p}\)</span> is a diagonal matrix with non-negative diagonal elements (called the Singular Values)</li>
<li><span class="math inline">\(V_{p\times p}\)</span> is an orthogonal matrix: its columns are an orthonormal basis of <span class="math inline">\(\mathbb R^p\)</span>, <span class="math inline">\(V'V = V V' = I\)</span>.</li>
</ul></li>
</ul>
<div>
<ul>
<li class="fragment"><p>Assuming <span class="math inline">\(d_1 &gt; d_2 &gt; \dots, d_p\)</span> on the diagonal of <span class="math inline">\(D\)</span> defines this decomposition uniquely.</p></li>
<li class="fragment"><p>Now denote the columns of <span class="math inline">\(V=[\mathbf{v}_1, \dots, \mathbf{v}_p]\)</span>, a basis of <span class="math inline">\(\mathbb R^p\)</span>, and the columns of <span class="math inline">\(U=[\mathbf{u}_1, \dots, \mathbf{u}_p]\)</span>.</p></li>
<li class="fragment"><p>Key observation: <span class="math inline">\(X\mathbf{v}_j = U D V' \mathbf{v}_j = UD \mathbf{e}_j = \mathbf{u}_j d_j\)</span> because of orthogonality of <span class="math inline">\(V\)</span></p></li>
</ul>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">

</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="using-the-svd-to-find-the-pca">Using the SVD to find the PCA</h3>
<div>
<ul>
<li class="fragment"><p>Given a vector <span class="math inline">\(\mathbf{v} \in \mathbb R^p\)</span> with <span class="math inline">\(\|\mathbf{v}\|^2=1\)</span>, express it in the <span class="math inline">\(V\)</span> columns basis: <span class="math inline">\(\mathbf{v} = a_1\mathbf{v}_1 + \dots + a_p \mathbf{v}_p \mbox{ with } a_1^2 + \dots + a_p^2 = 1\)</span></p></li>
<li class="fragment"><p>Now we can calculate its dispersion using the SVD: <span class="math inline">\(X\mathbf{v} = a_1 d_1 \mathbf{u}_1 + \dots + a_p d_p \mathbf{u}_p \Rightarrow \|X\mathbf{v}\|^2 = a_1^2 d_1^2 + \dots + a_p^2 d_p ^2\)</span></p></li>
<li class="fragment"><p>We know <span class="math inline">\(a_1^2 + \dots + a_p^2=1\)</span>, hence: <span class="math inline">\(\|X\mathbf{v}\|^2 \leq d_1^2.\)</span></p></li>
<li class="fragment"><p>But we get equality when <span class="math inline">\(\mathbf{v}=\mathbf{v}_1\)</span>, the first column of <span class="math inline">\(V\)</span>, hence <span class="math inline">\(\mathbf{v}_1\)</span> is the first PC</p></li>
<li class="fragment"><p>Similarly the second PC is defined by <span class="math inline">\(\mathbf{v}_2\)</span> in <span class="math inline">\(V\)</span>, and so on</p></li>
</ul>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">

</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="pca-via-eigendecomposition" class="slide level2 title-slide center">
<h2>PCA via Eigendecomposition</h2>
</section>
<section class="slide level2">

<h3 id="eigendecomposition">Eigendecomposition</h3>
<div class="fragment">
<p>A non-zero vector <span class="math inline">\(\mathbf{v}\)</span> is an eigenvector of a square <span class="math inline">\(p \times p\)</span> matrix <span class="math inline">\(\mathbf{A}\)</span> if it satisfies: <span class="math display">\[\mathbf{A}\mathbf{v} = \lambda\mathbf{v},\]</span> for some scalar <span class="math inline">\(\lambda\)</span>.</p>
</div>
<div>
<ul>
<li class="fragment"><p>Then <span class="math inline">\(\lambda\)</span> is called the eigenvalue corresponding to <span class="math inline">\(\mathbf{v}\)</span>.</p></li>
<li class="fragment"><p>Geometrically speaking, the eigenvectors of <span class="math inline">\(\mathbf{A}\)</span> are the vectors that <span class="math inline">\(\mathbf{A}\)</span> merely elongates or shrinks, and the amount that they elongate/shrink by is the eigenvalue</p></li>
<li class="fragment"><p>An eigendecomposition of <span class="math inline">\(\mathbf{A}\)</span> is then: <span class="math inline">\(\mathbf{A} = \mathbf{V}\mathbf{\Lambda}\mathbf{V}^{-1}\)</span></p></li>
<li class="fragment"><p>where <span class="math inline">\(\mathbf{V}\)</span> is the square <span class="math inline">\(n \times n\)</span> matrix whose <span class="math inline">\(j\)</span>th column is the eigenvector <span class="math inline">\(\mathbf{v}_j\)</span> of <span class="math inline">\(\mathbf{A}\)</span>, and <span class="math inline">\(\mathbf{\Lambda}\)</span> is the diagonal matrix whose diagonal elements are the corresponding eigenvalues, <span class="math inline">\(\mathbf{\Lambda}_{jj} = \lambda_j\)</span></p></li>
<li class="fragment"><p>If <span class="math inline">\(\mathbf{A}\)</span> is real and symmetric, <span class="math inline">\(\mathbf{V}\)</span> is orthogonal, <span class="math inline">\(\mathbf{A} = \mathbf{V}\mathbf{\Lambda}\mathbf{V}'\)</span> and <span class="math inline">\(\lambda_j\)</span> are real scalars</p></li>
<li class="fragment"><p>If <span class="math inline">\(\mathbf{A}\)</span> is also positive definite (PSD), then <span class="math inline">\(\lambda_j \ge 0\)</span></p></li>
</ul>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">

</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="calculating-principal-components-the-eigendecomposition">Calculating Principal Components: the Eigendecomposition</h3>
<div>
<ul>
<li class="fragment"><p>Look again at the PCA problem: <span class="math display">\[\mathbf{v}_1 = \arg\max_{\mathbf{v}:\|\mathbf{v}\|^2 =1} \|X\mathbf{v}\|^2\]</span></p></li>
<li class="fragment"><p>Using Lagrange multiplier <span class="math inline">\(\lambda_1\)</span>: <span class="math inline">\(\max_{\mathbf{v}_1}{\mathbf{v}_1'X'X\mathbf{v}_1} + \lambda_1(1 - \mathbf{v}_1'\mathbf{v}_1)\)</span></p></li>
<li class="fragment"><p>Take derivative with respect to <span class="math inline">\(\mathbf{v}_1\)</span>, compare to 0: <span class="math display">\[2X'X\mathbf{v}_1 - 2\lambda_1\mathbf{v}_1 = 0 \\
X'X\mathbf{v}_1 = \lambda_1\mathbf{v}_1\]</span></p></li>
<li class="fragment"><p>So <span class="math inline">\(\mathbf{v}_1\)</span> must be an eigenvector of the square, real, PSD <span class="math inline">\(X'X\)</span> matrix, and <span class="math inline">\(\lambda_1\)</span> its eigenvalue!</p></li>
<li class="fragment"><p>Which eigenvalue and eigenvector?</p></li>
</ul>
</div>
<aside class="notes">
<div style="direction:rtl; font-size:16px">

</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<ul>
<li><p>So we’re looking for the set of <span class="math inline">\(W_{p \times p}\)</span> eigenvectors of <span class="math inline">\(X'X\)</span> with their corresponding eigenvalues <span class="math inline">\(\lambda_1, \dots, \lambda_p\)</span> ordered from largest to smallest.</p></li>
<li><p>One can also show the <span class="math inline">\(\lambda_j\)</span> themselves are the variances of the PCs</p></li>
</ul>
<div>
<ul>
<li class="fragment">What is the relation to SVD?
<ul>
<li class="fragment">Let <span class="math inline">\(X = UVD'\)</span> as before</li>
<li class="fragment"><span class="math inline">\(X'X = VD'U'UDV = VD'DV = VD^2V\)</span></li>
<li class="fragment"><span class="math inline">\(D^2\)</span> is <span class="math inline">\(p \times p\)</span> diagonal with <strong>squared</strong> singular values on diagonal</li>
<li class="fragment">Which means <span class="math inline">\(V\)</span> are eigenvectors of and they’re also the required <span class="math inline">\(W\)</span> for PCA</li>
<li class="fragment">Eigenvalues <span class="math inline">\(\lambda_1, \dots, \lambda_p\)</span> are squared singular values <span class="math inline">\(d_1^2, \dots, d_p^2\)</span></li>
<li class="fragment">Either look at <span class="math inline">\(\lambda_1, \dots, \lambda_p\)</span> or <span class="math inline">\(d_1^2, \dots, d_p^2\)</span> for the PCs variance</li>
</ul></li>
</ul>
</div>
</section>
<section id="non-linear-pca" class="slide level2 title-slide center">
<h2>Non-Linear PCA</h2>
</section>
<section class="slide level2">

<h3 id="non-linear-relation">Non-linear Relation</h3>
<div class="columns">
<div class="column" style="width:50%;">
<p>Previously…</p>
<div class="cell" data-execution_count="25">
<div class="cell-output cell-output-display">
<p><img data-src="c05_pca_files/figure-revealjs/cell-26-output-1.png" width="513" height="429"></p>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>Now:</p>
<div class="cell" data-execution_count="26">
<div class="cell-output cell-output-display">
<p><img data-src="c05_pca_files/figure-revealjs/cell-27-output-1.png" width="534" height="429"></p>
</div>
</div>
</div>
</div>
<div class="fragment">
<p>Try non-linear PCA: Kernel PCA, Autoencoders</p>
</div>
<p><img src="../Intro2DS_logo_white.jpg" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://intro2ds2023.github.io/mooc/" target="_blank">Intro to Data Science</a></p>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="../libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../libs/revealjs/plugin/search/search.js"></script>
  <script src="../libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>